extends ../../index

append css
  link(rel="stylesheet",href="//cdn.bootcss.com/bootstrap-table/1.11.1/bootstrap-table.min.css")
  link(rel="stylesheet",href="//cdn.bootcss.com/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker.min.css")

append js
  script(src="//cdn.bootcss.com/moment.js/2.13.0/moment-with-locales.min.js")
  script(src='//cdn.bootcss.com/bootbox.js/4.4.0/bootbox.min.js')
  script(src='//cdn.bootcss.com/vue/2.2.1/vue.min.js')
  //script(src='/components/requirejs/require.js',data-main="/js/main")
  script(src="//cdn.bootcss.com/bootstrap-table/1.11.1/bootstrap-table.min.js")
  script(src="//cdn.bootcss.com/bootstrap-table/1.11.1/locale/bootstrap-table-zh-CN.min.js")
  script(src="//cdn.bootcss.com/bootstrap-datetimepicker/4.17.47/js/bootstrap-datetimepicker.min.js")
  if ENV_DEVELOPMENT
    script(src="//cdn.bootcss.com/vue/2.2.4/vue.js")
  else
    script(src="//cdn.bootcss.com/vue/2.2.4/vue.min.js")
  script(src='/js/course_view.js')
  style.
    .container .page-header {
      margin: 15px 0;
      padding-bottom: 3px;
    }
    .container .form-group {
      margin-bottom: 7px;
    }

block page
  div#course_app.container(style='padding-top:69px',data-course-id='#{courseID}')
    ol.breadcrumb
      li
        a(href="../home") 主页
      li
        a(href="../course") 班级列表
      li.active 查看班级
    div.page-header
      h3(style='margin-top:0;display:inline-block') 基本信息
      button.btn.btn-danger(type='button',style='float:right',:disabled='!course._id',@click='deleteCourse') 删除班级
    form.form-horizontal
      div.form-group
        label.col-sm-2.control-label 状态:
        select.col-sm-5.form-control(v-model='course.status',@change='closeAlert',style='margin-left:15px;width:auto')
          option.text-success(value='active') 进行中
          option.text-danger(value='closed') 结束
      div.form-group
        label.col-sm-2.control-label 名称:
        div.col-sm-5
          input.form-control(v-model.trim='course.name', placeholder='班级名称')
        div.col-sm-5
          p.form-control-static(style='color:#808080')
            small {{course.createDate | formatDate}}创建
      div.form-group
        label.control-label.col-sm-2 教室:
        select.form-control.col-sm-4(style='margin-left:15px;width:auto',v-model='course.classroom')
          - each room in classroom
            option(value=room.id)= room.name
      div.form-group
        label.control-label.col-sm-2 简介:
        div.col-sm-10
          textarea.form-control(rows='3', v-model.trim='course.remark')
      div.form-group
        div.col-sm-offset-2.col-sm-10
          button.btn.btn-success(type='button',:disabled='!course._id',v-on:click='saveBasicInfo') 保存
          div.alert.alert-danger(style='position:absolute;top:0px;left:100px;right:15px;padding:10px',v-if='error')
            strong 错误! 
            |{{error}}
    div.page-header
      h3 成员
    form.form-horizontal
      div.form-group
        div.col-sm-2
          button.btn.btn-primary.btn-sm(type="button",:disabled='!course._id',data-toggle='modal',data-target='#member_dlg')
            span.glyphicon.glyphicon-plus 添加
        div.col-sm-5
          ul.list-group(style='margin-bottom:0px')
            li.list-group-item(v-for="member in course.members")
              a(:href='"../member/" + member.id',style='margin-right:3px',target='_blank')
                i.glyphicon.glyphicon-user
              span.badge(style='background-color:#d9534f;cursor:pointer',@click='removeMember(member.id)') 移除
              | {{member.name}}
          small(style='color:#777') 共{{membersCount}}人
    div.page-header
      h3 课程
    form.form-horizontal
      div.form-group
        div.col-sm-2
          button.btn.btn-primary.btn-sm(type="button",:disabled='!course._id',data-toggle='modal',data-target='#class_dlg')
            span.glyphicon.glyphicon-plus 添加
        div.col-sm-5
          ul.list-group(style='margin-bottom:0px')
            li.list-group-item(v-for="item in course.classes")
              h4(style='margin: 3px 0') {{item.name}}
              a(href='javascript:void(0)',style='margin-right:3px',target='_blank')
                i.glyphicon.glyphicon-calendar
              span.small {{item.date | formatDateTime}} - {{item.classroom | formatClassroom}}
              span.badge(style='background-color:#d9534f;cursor:pointer',@click='removeClass(item._id)') 移除
          small(style='color:#777') 共0节
    div(style='height:20px')
  div#member_dlg.modal.fade(tabindex='-1',data-backdrop='static')
    div.modal-dialog
      div.modal-content
        div.modal-header
          button.close(type="button",data-dismiss="modal",aria-label="Close")
            span(aria-hidden="true") &times
          h4.modal-title 添加班级成员
        div.modal-body
          div.checkbox(style='position:absolute;top:25px;left:20px')
            label
              input(type='checkbox',name='onlyLatter',checked,disabled)
              |仅参加尚未开始的课程
          table#member_table(data-checkbox-header='false',data-striped='true',data-search='true',data-pagination='true',data-page-size='10',data-unique-id="_id",data-search-align='right',data-click-to-select='true')
            thead
              tr
                //th(data-field='_id',data-visible='false') ID
                th(data-checkbox='true')
                th(data-field='name',data-sortable='true') 宝宝姓名
                th(data-field='contact') 联系方式
                th(data-field='membership') 剩余课时
        div.modal-footer
          button.btn.btn-default(type="button",data-dismiss="modal") 取消
          button#add_member.btn.btn-success(type="button") 确定
  div#class_dlg.modal.fade(tabindex='-1',data-backdrop='static')
    div.modal-dialog
      div.modal-content
        div.modal-header
          button.close(type="button",data-dismiss="modal",aria-label="Close")
            span(aria-hidden="true") &times
          h4.modal-title 添加课程
        div.modal-body
          form.form-horizontal
            div.form-group(style='margin-bottom:7px')
              label.control-label.col-sm-2 时间/日期:
              div.col-sm-6
                div#class_date.input-group.date
                  input.form-control(text='text',name='brith')
                  span.input-group-addon
                    span.glyphicon.glyphicon-calendar
            div.form-group
              label.control-label.col-sm-2 教室:
              select#class_room.form-control.col-sm-4(style='margin-left:15px;width:auto')
                - each room in classroom
                  option(value=room.id)= room.name
            div.form-group(style='margin-bottom:7px')
              div.col-sm-offset-2.col-sm-10
                div.checkbox
                  label
                    input(type='checkbox',name='recurrence')
                    |每周重复
            div.recurrence-panel(style='display:none')
              div.form-group(style='margin-bottom:7px')
                label.control-label.col-sm-2 每周:
                div.weekdays.col-sm-10(style='display:flex;flex-wrap:wrap')
                  - each day,index in ['星期日','星期一','星期二','星期三','星期四','星期五','星期六']
                    div.checkbox(style='margin:0 30px 0 0')
                      label
                        input(type="checkbox", name="weekday", value="#{index}")
                        | #{day}
              div.form-group(style='margin-bottom:7px')
                label.control-label.col-sm-2 开始日期:
                div.col-sm-5
                  div#class_begin.input-group.date
                    input.form-control(text='text',name='begin')
                    span.input-group-addon
                      span.glyphicon.glyphicon-calendar
              div.form-group(style='margin-bottom:7px')
                label.control-label.col-sm-2 结束:
                div.col-sm-5
                  div#class_end.input-group.date
                    input.form-control(text='text',name='end')
                    span.input-group-addon
                      span.glyphicon.glyphicon-calendar
        div.modal-footer
          button.btn.btn-default(type="button",data-dismiss="modal") 取消
          button#add_class.btn.btn-success(type="button") 确定